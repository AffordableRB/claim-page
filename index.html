async function verifyUsername() {
    const username = document.getElementById('robloxUsername').value.trim();
    const verifyBtn = document.getElementById('verifyBtn');
    
    if (!username) {
        showError('Please enter a username');
        return;
    }
    
    // Basic username validation
    if (username.length < 3 || username.length > 20) {
        showError('Username must be between 3-20 characters');
        return;
    }
    
    if (!/^[a-zA-Z0-9_]+$/.test(username)) {
        showError('Username can only contain letters, numbers, and underscores');
        return;
    }
    
    verifyBtn.innerHTML = '<span class="loading"></span>Verifying...';
    verifyBtn.disabled = true;
    
    try {
        // Step 1: Get Roblox user ID from username
        const userIdResponse = await fetch(`https://api.roblox.com/users/get-by-username?username=${encodeURIComponent(username)}`);
        const userIdData = await userIdResponse.json();

        if (userIdData.success === false) {
            showError('Username not found on Roblox.');
            verifyBtn.innerHTML = 'Verify Username';
            verifyBtn.disabled = false;
            return;
        }

        const userId = userIdData.Id;

        // Step 2: Fetch the headshot image URL
        const avatarResponse = await fetch(`https://thumbnails.roblox.com/v1/users/avatar-headshot?userIds=${userId}&size=150x150&format=Png&isCircular=true`);
        const avatarData = await avatarResponse.json();

        const avatarUrl = avatarData.data[0]?.imageUrl || '';

        if (!avatarUrl) {
            showError('Failed to load avatar image.');
            verifyBtn.innerHTML = 'Verify Username';
            verifyBtn.disabled = false;
            return;
        }

        // Store user data and show confirmation
        currentUserData = {
            username: username,
            avatar: avatarUrl
        };

        // Update profile display
        const avatarImg = document.getElementById('profileAvatar');
        avatarImg.src = currentUserData.avatar;
        avatarImg.alt = `${username}'s Avatar`;

        document.getElementById('profileName').textContent = currentUserData.username;

        showStep(2);

    } catch (error) {
        console.error('Verification error:', error);
        showError('Unable to verify username. Please check spelling and try again.');
    } finally {
        verifyBtn.innerHTML = 'Verify Username';
        verifyBtn.disabled = false;
    }
}
